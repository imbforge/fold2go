process {
    withName: ALPHAFOLD {
        container  = "/fsimb/common/singularity_tools/alphafold/v2.3.2r0_hpc4/alphafold_2.3.2.sif"

        cpus       = 2
        time       = { 1.h * task.attempt }
        memory     = 16.GB

        publishDir =
            [
                [
                    path: { "${params.OUT}/${workflow.runName}/predictions/${meta*.value.join('.')}" },
                    saveAs: { it.split("/").last() }
                ]
            ]
    }
}

process {
    withName: MSA {
        container  = "/fsimb/common/singularity_tools/alphafold/v2.3.2r0_hpc4/alphafold_2.3.2.sif"
        
        cpus       = 4
        time       = { 1.h * task.attempt }
        memory     = 64.GB

        executor = "local" // FIXME: this should go to compute nodes via slurm, but first alphafold database needs reside on fast storage there 
        maxForks = 8       // FIXME: as long as we're running this on hpcgpu, limit cpu usage per pipeline instance to 8*4=32 cores

        publishDir =
            [
                [
                    path: { "${params.OUT}/msa" }
                ]
            ]
    }
}